# 장애 보고서

## 장애 요약

- 장애 발생 일시: 2025년 2월 28일, 01:25 (KST)
- 장애 증상:
    - 사용자 콘서트 조회 API에서 요청 대기 시간이 평균 24ms를 유지하던 중 갑자기 최대 1s, p99기준 400ms 까지 지연되는 현상 발생
    - 데이터베이스 CPU 및 WAS 의 CPU 사용량 80% 이상으로 급증

## 장애 영향도

- 영향을 받은 서비스: 콘서트 예약 예약 서비스, 사용자 인터페이스
- 영향을 받은 사용자: 전체 사용자 중 30%가 콘서트 조회시 "느려지는 불편함"을 겪음.
- 영향 범위: 콘서트 예약 서비스 및 콘서트 관련 DB
- 비즈니스 영향도:
    - 전체적인 예약 서비스에 오류는 없으나 조회 성능의 이슈로 인해 사용자 불편 발생
    - 추후 조회 성능의 이슈로 인해 실제 예약으로 진행될 수 있는 고객의 이탈 가능성 발생
    - 서비스 신뢰도 하락 및 콘서트 예약 서비스 자체를 이용하는 고객의 이탈 우려

## 장애 원인

- 원인 분석:
    - 데이터베이스 연결 수용 한계 초과: 데이터베이스 연결 수가 설정된 최대 한계를 초과하여, 일부 사용자 요청을 처리하는데 지연이 발생
    - HA를 위한 클러스터링 부재: 트래픽 급증 시 HA를 위한 클러스터링된 서버없이 단일 서버로 운영 중
    - 자원 부족: 단일 서버의 메모리 및 CPU 자원이 부족해짐

- 근본 원인:
    - 서버 성능 및 자원 분배에 대한 관리 부족
    - 예상보다 높은 사용자 트래픽을 처리하기 위한 충분한 용량 확보 실패

## 장애 처리 타임라인별 행동

| 시간    | 조치 내용                                           | 담당자  |
|-------|-------------------------------------------------|------|
| 01:25 | 콘서트 조회 API의 request duration이 증가하기 시작함을 알람으로 받음 | 개발팀  |
| 01:35 | 시스템 로그 분석 시작                                    | 개발팀  |
| 01:40 | 데이터베이스 연결 풀 설정 확인                               | DB팀  |
| 01:50 | 서버 리소스 할당량 증가 및 트래픽 제한 설정                       | 인프라팀 |
| 02:00 | 장애 복구 완료 및 시스템 정상화                              | 전 팀  |
| 03:00 | 원인 분석 및 재발 방지 대책 수립                             | 개발팀  |

## 장애 재발 대책 (포카요케)

- 대용량 트래픽 대비한 시스템 구축: 트래픽 패턴을 분석하여 부하 분산 시스템을 재설계하고, 트래픽 급증 시 자동으로 리소스 확장할 수 있게 시스템 구축
- 예방적 테스트 도입: 트래픽 예측 테스트 및 부하 테스트를 통해 시스템 성능을 사전에 점검하고, 실제 상황을 반영한 성능 최적화

## 그 외 추가 정보

- 장애 처리 후 점검:
    - 모든 사용자 요청을 정상적으로 처리하고 있으며, 현재까지 추가적인 장애는 발생하지 않음
    - 시스템 성능 최적화 작업이 완료되었으며, 트래픽 급증 상황에서의 안정성 확보 완료

- 향후 계획:
    - 해당 장애를 재발하지 않도록 시스템 아키텍처 및 자원 분배에 대한 전반적인 재검토 진행
    - 조회 성능을 위해 캐싱 전략을 도입할 수 있는지 검토 후 도입 예정
